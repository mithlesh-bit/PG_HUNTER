<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <title>Document</title>
</head>

<body>



  <head>
    <link rel="shortcut icon" href="/assets/img/favicon.ico" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roomoza</title>
    <link rel="stylesheet" href="/css/index.css" />
    <!-- Unicons -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <script src="https://kit.fontawesome.com/dc5e06456d.js" crossorigin="anonymous"></script>
    <!-- for alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/creativetimofficial/tailwind-starter-kit/compiled-tailwind.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/dash.css" />

  </head>

  <header class="header">
    <nav class="nav">
      <a href="/landing" class="nav_logo">ROOMOZA</a>

      <ul class="nav_items">
        <li class="nav_item">
          <a href="/" class="nav_link">Home</a>
          <a href="#" class="nav_link">Find PG</a>
          <a href="#" class="nav_link">Services</a>
          <a href="/landing" class="nav_link">About</a>
        </li>
      </ul>

    </nav>
  </header>

  <section class="w-full flex justify-center pt-16">

    <div class="max-w-[1100px] w-11/12 mt-10 rounded-lg p-4 card mb-12">

      <% if (user ) { %>
        <div class="bg-secondary d-lg-inline-block py-3 px-1 px-sm-6 mb-1-9 rounded-sm p-2 cards">
         
        <div class="flex justify-between ">
          <h3 class="h2 text-black mb-0"><%= user.name %></h3>
          <div>
            <p>Email: <%= user.email %>
            </p>
            <p>Contact: <%= user.contact %>
            </p>

          </div>

        </div>
        </div>

        <!-- Iterate through user images and display with delete buttons -->
        <% for (let index=0; index < user.image.length; index++) { %>
          <img src="<%= user.image[index].url %>">
          <button data-id="<%= user.image[index]._id %>" onclick="deleteImage(this)">Delete</button>
          <% } %>
            <% } else { %>
              <p>User data is not available.</p>
              <% } %>
                <form id="myForm" action="/dashboard" method="post" enctype="multipart/form-data">
                  <!-- <div class="mb-3">
                    <label for="exampleInputPassword1" class="form-label">Enter png Icon (Optional)</label>
                    <input type="file" id="photo" name="image" /><br /><br />
                  </div> -->

                  <div class="form">

                    <div class="mb-3 form_item">
                      <label for="namehome" class="form-label">Name Home</label>
                      <input type="text" class="form-control" id="namehome" name="namehome" />
                    </div>

                    <div class="form_item">
                      <label for="service"  class="form-label">Service</label>
                      <select name="service" placeholer class="form-control"  id="service">
                        <option value="PG">PG</option>
                        <option value="FLAT">Flat</option>
                        <option value="HOSTEL">Hostel</option>
                      </select>
                    </div>
  
  
                    <div class="mb-3 form_item">
                      <label for="forValue" class="form-label">For</label>
                      <select name="forValue" class="form-control"  id="forValue">
                        <option value="BOY">Boy</option>
                        <option value="GIRL">Girl</option>
                        <option value="FAMILY">Family</option>
                      </select>
                    </div>

                    <div class="mb-3 form_item">
                      <label for="current_status" class="form-label">current status</label>
                      <input type="text" class="form-control" id="current_status" name="current_status" />
                    </div>
                  </div>
                  <div class="mb-3 form_item">
                    <label for="highlight" class="form-label">Highlight</label>
                    <textarea name="highlight" class="form-control" id="highlight" cols="30" rows="3"></textarea>
                  </div>
                  
                  <div class="form">  
                    <div class="mb-3 form_item">
                      <label for="location" class="form-label">Location</label>
                      <div class="flex">
                        <input type="text" class="form-control" id="location" name="location" />
                        <button type="button"  onclick="getLocation()">Get Current Location</button>
                      </div>
                    </div>
  
                    
  
                    <div class="mb-3 form_item">
                      <label for="contact" class="form-label">Contact</label>
                      <input type="text" class="form-control" id="contact" name="contact" />
                    </div>
                  </div>

                  

                  <!-- Adding hidden input fields for latitude and longitude -->
                  <input type="hidden" id="latitude" name="latitude" />
                  <input type="hidden" id="longitude" name="longitude" />


                  <button type="submit" class="btn btn-light mt-3">UPDATE</button>
                  <!-- <p>Not a member? <a href="#">Signup now</a></p> -->
                </form>
                <a href="/logout">logout</a>
    </div>
  </section>

  <!-- Add this JavaScript code to your HTML file -->
  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(sendLocation);
      } else {
        alert('Geolocation is not supported by this browser.');
      }
    }

    async function sendLocation(position) {
      const { latitude, longitude } = position.coords;

      // Make an API request to OpenCage Geocoding using fetch
      try {
        const apiKey = '39a5aeb3daa64655b405c79ad98952ba'; // Replace with your API key
        const apiUrl = `https://api.opencagedata.com/geocode/v1/json?key=${apiKey}&q=${latitude},${longitude}`;

        const response = await fetch(apiUrl);

        if (response.ok) {
          const data = await response.json();
          if (data.results.length > 0) {
            const location = data.results[0].formatted;

            // Set the value of the "location" input field with the retrieved address
            const locationInput = document.getElementById('location');
            locationInput.value = location;
          } else {
            console.log('Address not found.');
          }
        } else {
          console.error('Error fetching address:', response.status);
        }
      } catch (error) {
        console.error('Error fetching address:', error);
      }
    }

  </script>
  <script>
    function deleteImage(button) {
      const imageId = button.getAttribute('data-id');

      // Make an HTTP DELETE request to the server to delete the image by its _id
      fetch(`/deleteImage/${imageId}`, {
        method: 'DELETE',
      })
        .then((response) => {
          if (response.status === 204) {
            // The image was successfully deleted
            // You can update the UI or perform any other necessary actions
            location.reload(); // Refresh the page to reflect the updated image list
          } else {
            // Handle error response
            console.error('Failed to delete image');
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

  </script>
</body>

</html>